{% extends "admin/change_list.html" %}
{% load i18n %}
{% load humanize %}

{% block content_title %}
    <h1> {% trans 'Courier Statistics' %} </h1>
{% endblock %}

{% block result_list %}
    <style>
        .bar-chart {
            display: flex;
            justify-content: space-around;
            height: 160px;
            padding-top: 60px;
            overflow: hidden;
        }

        .bar-chart .bar {
            flex: 100%;
            align-self: flex-end;
            margin-right: 2px;
            position: relative;
            background-color: #79aec8;
        }

        .bar-chart .bar:last-child {
            margin: 0;
        }

        .bar-chart .bar:hover {
            background-color: #417690;
        }

        .bar-chart .bar .bar-tooltip {
            position: absolute;
            top: -60px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            font-weight: bold;
            opacity: 0;
        }

        .bar-chart .bar:hover .bar-tooltip {
            opacity: 1;
        }
    </style>

    <!-- Display today's, weekly, and monthly statistics -->
    <div class="statistics-summary">
        <p><strong>{% trans "Today's Deliveries" %}:</strong> {{ todays_stats|length }}</p>
        <p><strong>{% trans "This Week's Deliveries" %}:</strong> {{ weekly_stats|length }}</p>
        <p><strong>{% trans "This Month's Deliveries" %}:</strong> {{ monthly_stats|length }}</p>
    </div>

    <div class="results">
        <table>
            <thead>
            <tr>
                <th>{% trans 'Period' %}</th>
                <th>{% trans 'Delivered Orders' %}</th>
                <th>{% trans 'Delivering Orders' %}</th>
                <th>{% trans 'New Orders' %}</th>
                <th>{% trans 'Percentage' %}</th>
                <th>{% trans 'Total Orders' %}</th>
            </tr>
            </thead>
            <tbody>
            {% for stat in summary_over_time %}
                <tr>
                    <td>{{ stat.period|capfirst }}</td>
                    <td>{{ stat.delivered_count }}</td>
                    <td>{{ stat.delivering_count }}</td>
                    <td>{{ stat.new_count }}</td>
                    <td>{{ stat.pct }}%</td>
                    <td>{{ stat.total_count }}</td>
                </tr>
            {% endfor %}
            
            </tbody>
        </table>

        <div class="bar-chart">
            {% for x in summary_over_time %}
                <div class="bar" style="height:{{ x.pct }}%">
                    <div class="bar-tooltip">
                        {{ x.total_count }}<br>
                        {{ x.period|date:"d/m/Y" }}
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
{% endblock %}

{% block pagination %}{% endblock %}
